name: Génération de Carte à Gratter

on:
  workflow_dispatch:
    inputs:
      background_image:
        description: "URL de l'image de fond"
        required: true
      message_text:
        description: "Texte pour la carte"
        required: true
      text_color:
        description: "Couleur du texte"
        required: true

jobs:
  create_card:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Afficher les paramètres de création de carte
        run: |
          echo "Image de fond : ${{ github.event.inputs.background_image }}"
          echo "Texte : ${{ github.event.inputs.message_text }}"
          echo "Couleur du texte : ${{ github.event.inputs.text_color }}"

      - name: Créer un nouveau dépôt pour la carte
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          REPO_NAME="card-$(date +%s)"
          echo "Nom du dépôt : $REPO_NAME"

          # Cloner le modèle de carte à gratter
          git clone https://$GH_TOKEN@github.com/lumios-le-jeu/carte-a-gratter-template.git $REPO_NAME
          
          # Aller dans le dossier du nouveau dépôt
          cd $REPO_NAME
          
          # Personnalisation de la carte avec les paramètres
          sed -i "s|BACKGROUND_IMAGE_URL|${{ github.event.inputs.background_image }}|g" index.html
          sed -i "s|MESSAGE_TEXT|${{ github.event.inputs.message_text }}|g" index.html
          sed -i "s|TEXT_COLOR|${{ github.event.inputs.text_color }}|g" index.html

          # Initialisation du nouveau dépôt Git
          git init
          git add .
          git commit -m "Carte personnalisée générée automatiquement"
          git branch -M main
          git remote add origin https://$GH_TOKEN@github.com/lumios-le-jeu/$REPO_NAME.git
          git push -u origin main

      - name: Post Checkout
        if: success()
        run: |
          echo "Le dépôt a été créé et le contenu a été personnalisé."
